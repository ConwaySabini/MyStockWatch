{"version":3,"sources":["../../server/fetch/analyze-api.js"],"names":["dotenv","require","redis","google","OAuth2","auth","nodemailer","axios","default","setRSI","symbol","method","url","params","interval","outputsize","series_type","time_period","format","headers","process","env","REACT_APP_RAPIDAPI_HOST","REACT_APP_RAPIDAPI_KEY","setOBV","setBBANDS","ma_type","sd","setOptions","REACT_APP_RAPIDAPI_TIME_URL","createEmailTransporter","oauth2Client","CLIENT_ID","CLIENT_SECRET","setCredentials","refresh_token","REFRESH_TOKEN","accessToken","Promise","resolve","reject","getAccessToken","err","token","createTransport","service","type","user","MAIL_USERNAME","pass","MAIL_PASSWORD","clientId","OAUTH_CLIENTID","clientSecret","OAUTH_CLIENT_SECRET","refreshToken","OAUTH_REFRESH_TOKEN","sendMail","mailOptions","transporter","data","console","log","getUserEmail","userId","GET_USER","response","request","status","message","email","error","getUserSubscriptions","GET_SUBSCRIPTIONS","GET_SUBSCRIPTIONS_BY_USER","updateSubscriptionsByUser","subscriptions","calculateBBANDS","values","push","taIndex","length","i","lower_band","middle_band","upper_band","getBBANDS","BBANDS","getPrice","currentPrice","close","rsi","getRSI","userSubscriptions","updateSubscriptions","from","to","subject","text","res","RSI","getOBV","STOCH","stoch","options","analyzeStock","module","exports"],"mappings":"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","sourcesContent":["const dotenv = require('dotenv');\nconst redis = require(\"redis\");\nconst { google } = require('googleapis');\nconst OAuth2 = google.auth.OAuth2;\nconst nodemailer = require(\"nodemailer\");\nconst axios = require('axios').default;\n// const client = redis.createClient();\n\n// const { promisify } = require(\"util\");\n// const setAsync = promisify(client.set).bind(client);\n\n// Relative Strength Index(RSI) is a momentum indicator, \n// which calculates the magnitude of a price change to assess \n// the overbought and oversold conditions in the price of an asset.\nfunction setRSI(symbol) {\n    return {\n        method: 'GET',\n        url: 'https://twelve-data1.p.rapidapi.com/rsi',\n        params: {\n            symbol: `${symbol}`,\n            interval: '5min',\n            outputsize: '30',\n            series_type: 'close',\n            time_period: '14',\n            format: 'json'\n        },\n        headers: {\n            'x-rapidapi-host': process.env.REACT_APP_RAPIDAPI_HOST,\n            'x-rapidapi-key': process.env.REACT_APP_RAPIDAPI_KEY\n        }\n    };\n}\n\n// On Balance Volume(OBV) is a momentum indicator, which uses volume flow to forecast upcoming price changes.\nfunction setOBV(symbol) {\n    return {\n        method: 'GET',\n        url: 'https://twelve-data1.p.rapidapi.com/obv',\n        params: {\n            interval: '5min',\n            symbol: `${symbol}`,\n            series_type: 'close',\n            outputsize: '30',\n            format: 'json'\n        },\n        headers: {\n            'x-rapidapi-host': process.env.REACT_APP_RAPIDAPI_HOST,\n            'x-rapidapi-key': process.env.REACT_APP_RAPIDAPI_KEY\n        }\n    };\n}\n\n// Bollinger BandsÂ®(BBANDS) are volatility bands located above and below a moving average. \n// The volatility size parameter depends on standard deviation.\nfunction setBBANDS(symbol) {\n    return {\n        method: 'GET',\n        url: 'https://twelve-data1.p.rapidapi.com/bbands',\n        params: {\n            interval: '5min',\n            symbol: `${symbol}`,\n            format: 'json',\n            outputsize: '30',\n            time_period: '20',\n            ma_type: 'SMA',\n            series_type: 'close',\n            sd: '2'\n        },\n        headers: {\n            'x-rapidapi-host': process.env.REACT_APP_RAPIDAPI_HOST,\n            'x-rapidapi-key': process.env.REACT_APP_RAPIDAPI_KEY\n        }\n    };\n}\n\n// Axios options for getting stock data from 12 Data API\nfunction setOptions(symbol) {\n    return {\n        method: 'GET',\n        url: process.env.REACT_APP_RAPIDAPI_TIME_URL,\n        params: { interval: '5min', symbol: `${symbol}`, format: 'json', outputsize: '30' },\n        headers: {\n            'x-rapidapi-host': process.env.REACT_APP_RAPIDAPI_HOST,\n            'x-rapidapi-key': process.env.REACT_APP_RAPIDAPI_KEY\n        }\n    };\n}\n\nasync function createEmailTransporter() {\n\n    const oauth2Client = new OAuth2(\n        process.env.CLIENT_ID,\n        process.env.CLIENT_SECRET,\n        \"https://developers.google.com/oauthplayground\"\n    );\n\n    oauth2Client.setCredentials({\n        refresh_token: process.env.REFRESH_TOKEN\n    });\n\n    const accessToken = await new Promise((resolve, reject) => {\n        oauth2Client.getAccessToken((err, token) => {\n            if (err) {\n                reject(\"Failed to create access token :(\");\n            }\n            resolve(token);\n        });\n    });\n\n    // create nodemailer transporter\n    return nodemailer.createTransport({\n        service: 'gmail',\n        auth: {\n            type: 'OAuth2',\n            user: process.env.MAIL_USERNAME, accessToken,\n            pass: process.env.MAIL_PASSWORD,\n            clientId: process.env.OAUTH_CLIENTID,\n            clientSecret: process.env.OAUTH_CLIENT_SECRET,\n            refreshToken: process.env.OAUTH_REFRESH_TOKEN\n        }\n    });\n}\n\n// Send an email with the following options\nasync function sendMail(mailOptions) {\n    let transporter = await createEmailTransporter();\n\n    transporter.sendMail(mailOptions, function (err, data) {\n        if (err) {\n            console.log(\"Error \" + err);\n        } else {\n            console.log(\"Email sent successfully\");\n        }\n    });\n}\n\nasync function getUserEmail(userId) {\n    try {\n        const GET_USER = process.env.GET_USER + userId;\n        const response = await axios.request(GET_USER);\n        // handle error\n        if (response.data.status === \"error\") {\n            console.log(response.data.message);\n        } else {\n            console.log(\"email \", response.data.email);\n            return response.data.email;\n        }\n        // handle error \n    } catch (error) {\n        console.error(error);\n    }\n}\n\nasync function getUserSubscriptions(userId) {\n    try {\n        const GET_SUBSCRIPTIONS = process.env.GET_SUBSCRIPTIONS_BY_USER + userId;\n        const response = await axios.request(GET_SUBSCRIPTIONS);\n        // handle error\n        if (response.data.status === \"error\") {\n            console.log(response.data.message);\n        } else {\n            console.log(\"subscriptions \", response.data);\n            return response.data;\n        }\n        // handle error \n    } catch (error) {\n        console.error(error);\n    }\n}\n\nasync function updateSubscriptionsByUser(userId, subscriptions) {\n    //TODO implement\n    try {\n        const GET_SUBSCRIPTIONS = process.env.GET_SUBSCRIPTIONS_BY_USER + userId;\n        const response = await axios.request(GET_SUBSCRIPTIONS);\n        // handle error\n        if (response.data.status === \"error\") {\n            console.log(response.data.message);\n        } else {\n            console.log(\"subscriptions \", response.data);\n            return response.data;\n        }\n        // handle error \n    } catch (error) {\n        console.error(error);\n    }\n}\n\n// Calculate the Bollinger Bands over a period of time\nconst calculateBBANDS = (data) => {\n    let values = [];\n    values.push([]);\n    values.push([]);\n    values.push([]);\n    // 30 dates and prices for the graph\n    let taIndex = data.values.length - 1;\n    // Loop through each date and price for the stock and add it to the arrays\n    for (let i = 0; i < data.values.length; i++) {\n        values[0][taIndex] = data.values[i].lower_band;\n        values[1][taIndex] = data.values[i].middle_band;\n        values[2][taIndex] = data.values[i].upper_band;\n        taIndex--;\n    }\n    return values;\n}\n\nasync function getBBANDS(userId, symbol) {\n    try {\n        let BBANDS = setBBANDS(symbol);\n        const response = await axios.request(BBANDS);\n        const data = await getPrice(symbol);\n        // handle error\n        if (response.data.status === \"error\") {\n            console.log(response.data.message);\n        } else {\n            const values = calculateBBANDS(response.data);\n            const currentPrice = data.values[0].close;\n            // if the price is above the middle band, buy signal\n            if (currentPrice < values[0][29]) {\n                let rsi = await getRSI(symbol);\n                if (rsi) {\n                    const email = await getUserEmail(userId);\n                    const userSubscriptions = await getUserSubscriptions(userId);\n                    const updateSubscriptions = await updateSubscriptionsByUser(userId, userSubscriptions);\n\n                    // Options for sending the mail\n                    let mailOptions = {\n                        from: process.env.MAIL_USERNAME,\n                        to: 'tomerpacific@gmail.com',\n                        subject: 'Nodemailer Project',\n                        text: 'Hi from your nodemailer project',\n                    };\n\n                    const res = await sendMail(mailOptions);\n\n                    // TODO send buy email if rsi below 30\n                    // TODO set stoploss at -10%???\n                    // TODO take profit when price breaks above upper bollinger band\n                } else {\n                    // TODO modify database and wait until rsi is above 70 or below 30 to send email\n                    // TODO boolean for if bollinger band has crossed middle line to confirm buy or sell signal when waiting for rsi to confirm\n                }\n            }\n        }\n        // handle error\n    } catch (error) {\n        console.error(error);\n    }\n}\n\nasync function getRSI(symbol) {\n    try {\n        let RSI = setRSI(symbol);\n        const response = await axios.request(RSI);\n        // handle error\n        if (response.data.status === \"error\") {\n            console.log(response.data.message);\n        } else {\n            if (response.data.rsi > 70) {\n                // return false as sell signal for stock\n                return false;\n            } else if (response.data.rsi < 30) {\n                // return true as buy signal for stock\n                return true;\n            }\n        }\n        // handle error\n    } catch (error) {\n        console.error(error);\n    }\n}\n\nasync function getOBV() {\n    try {\n        const response = await axios.request(STOCH);\n        // handle error\n        if (response.data.status === \"error\") {\n            console.log(response.data.message);\n        } else {\n            if (stoch > 80) {\n                // Overbought condition, take sell position?\n            } else if (stoch < 20) {\n                // Oversold condition, take buy position?\n\n\n\n            }\n        }\n        // handle error\n    } catch (error) {\n        console.error(error);\n    }\n}\n\nasync function getPrice(symbol) {\n    try {\n        let options = setOptions(symbol);\n        const response = await axios.request(options);\n        // handle error\n        if (response.data.status === \"error\") {\n            console.log(response.data.message);\n        } else {\n            return response.data\n        }\n        // handle error\n    } catch (error) {\n        console.error(error);\n    }\n}\n\n// Gets the data\nasync function analyzeStock(userId, symbol) {\n    // TODO check if starting signals have been met (above bollinger bands, etc)\n    // TODO skip checking those signals that have already been met\n    const data = await getBBANDS(userId, symbol);\n\n    // store data in redis\n    // const success = await setAsync('github', JSON.stringify(interns));\n    // console.log({ success });\n}\n\n//fetchGithub();\n\nmodule.exports = analyzeStock;\n"],"file":"analyze-api.js"}